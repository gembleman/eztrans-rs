# ë©€í‹°í”„ë¡œì„¸ìŠ¤ ìœ ë‹ˆì½”ë“œ ìŠ¤ìº” ê°€ì´ë“œ

## ê°œìš”

EzTrans DLLì„ ì‚¬ìš©í•œ ìœ ë‹ˆì½”ë“œ ìŠ¤ìº”ì—ì„œ ë©€í‹°í”„ë¡œì„¸ì‹±ì„ êµ¬í˜„í•  ë•Œ ë°œê²¬ëœ ë¬¸ì œì ê³¼ í•´ê²°ì±…ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ì™œ ë©€í‹°í”„ë¡œì„¸ìŠ¤ì¸ê°€? (Thread-Local ë¶ˆê°€ ì´ìœ )

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

| ì ‘ê·¼ë²• | ê²°ê³¼ | ë¹„ê³  |
|--------|------|------|
| ë‹¨ì¼ ìŠ¤ë ˆë“œ ìˆœì°¨ | âœ… ì‘ë™ | ê¸°ë³¸ ì‚¬ìš©ë²• |
| ë‹¨ì¼ ìŠ¤ë ˆë“œ ë‹¤ì¤‘ ì—”ì§„ | âœ… ì‘ë™ | ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ë²ˆê°ˆì•„ ì‚¬ìš© ê°€ëŠ¥ |
| Thread-Local ì—”ì§„ | âŒ ë¶ˆê°€ | LoadLibraryê°€ ë™ì¼ HMODULE ë°˜í™˜ |
| Mutex ë³´í˜¸ ë‹¤ì¤‘ ì—”ì§„ | âŒ ì¼ë¶€ ì‹¤íŒ¨ | DLL ì „ì—­ ìƒíƒœ ì¶©ëŒ |
| ë©€í‹°ìŠ¤ë ˆë“œ ë™ì‹œ ì ‘ê·¼ | âŒ í¬ë˜ì‹œ | Segfault, Heap Corruption |
| **ë©€í‹°í”„ë¡œì„¸ìŠ¤** | âœ… **ì‘ë™** | ìœ ì¼í•œ ë³‘ë ¬í™” ë°©ë²• |

### DLL ë‚´ë¶€ êµ¬ì¡° ë¶„ì„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ ë‚´ë¶€                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         J2KEngine.dll ì „ì—­ ìƒíƒœ                      â”‚   â”‚
â”‚  â”‚  - ì´ˆê¸°í™” í”Œë˜ê·¸                                      â”‚   â”‚
â”‚  â”‚  - ì‚¬ì „ ë°ì´í„°                                        â”‚   â”‚
â”‚  â”‚  - ë‚´ë¶€ ë²ˆì—­ ë²„í¼ (Thread-Unsafe!)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â†‘              â†‘              â†‘                     â”‚
â”‚         â”‚              â”‚              â”‚                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚Engine 1 â”‚    â”‚Engine 2 â”‚    â”‚Engine 3 â”‚              â”‚
â”‚    â”‚HMODULE: â”‚    â”‚HMODULE: â”‚    â”‚HMODULE: â”‚              â”‚
â”‚    â”‚0x648e0000â”‚   â”‚0x648e0000â”‚   â”‚0x648e0000â”‚  â† ë™ì¼!    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                             â”‚
â”‚    Thread 1        Thread 2        Thread 3                â”‚
â”‚    (ë²ˆì—­ í˜¸ì¶œ)     (ë²ˆì—­ í˜¸ì¶œ)     (ë²ˆì—­ í˜¸ì¶œ)              â”‚
â”‚         â†“              â†“              â†“                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                        â†“                                    â”‚
â”‚              ğŸ’¥ ë²„í¼ ì¶©ëŒ! ğŸ’¥                              â”‚
â”‚              - ì¶œë ¥ í˜¼í•©                                    â”‚
â”‚              - ë¹ˆ ê²°ê³¼ ë°˜í™˜                                 â”‚
â”‚              - Heap Corruption                             â”‚
â”‚              - Segmentation Fault                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ë°œê²¬ì‚¬í•­

1. **LoadLibraryA ë™ì‘**: ì´ë¯¸ ë¡œë“œëœ DLLì— ëŒ€í•´ **ë™ì¼í•œ HMODULE** ë°˜í™˜
   ```
   Engine 1 HMODULE: 0x648e0000
   Engine 2 HMODULE: 0x648e0000  â† ê°™ì€ í•¸ë“¤!
   ```

2. **DLL ì „ì—­ ìƒíƒœ ê³µìœ **: Engine2ë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•Šì•„ë„ Engine1ì˜ ì´ˆê¸°í™” ìƒíƒœë¡œ ë²ˆì—­ ê°€ëŠ¥
   ```rust
   // Engine1ë§Œ ì´ˆê¸°í™”
   engine1.initialize_ex("CSUSER123455", &dat_path)?;

   // Engine2ëŠ” ì´ˆê¸°í™” ì—†ì´ë„ ì‘ë™! (DLL ìƒíƒœ ê³µìœ )
   engine2.translate_mmntw("ãƒ†ã‚¹ãƒˆ")  // â†’ "í…ŒìŠ¤íŠ¸" (ì‘ë™í•¨)
   ```

3. **ë™ì‹œ ì ‘ê·¼ ì‹œ ì¶©ëŒ**: ë²ˆì—­ í•¨ìˆ˜ ë‚´ë¶€ ë²„í¼ê°€ thread-safeí•˜ì§€ ì•ŠìŒ
   - ê°™ì€ ìŠ¤ë ˆë“œì—ì„œ ìˆœì°¨ í˜¸ì¶œ: âœ… ì‘ë™
   - ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ë™ì‹œ í˜¸ì¶œ: âŒ ì¶©ëŒ

### ë©€í‹°í”„ë¡œì„¸ìŠ¤ê°€ ìœ ì¼í•œ í•´ê²°ì±…ì¸ ì´ìœ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Process 1   â”‚  â”‚  Process 2   â”‚  â”‚  Process 3   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ J2KEngine.dllâ”‚  â”‚ J2KEngine.dllâ”‚  â”‚ J2KEngine.dllâ”‚
â”‚ (ë…ë¦½ ì¸ìŠ¤í„´ìŠ¤)â”‚  â”‚ (ë…ë¦½ ì¸ìŠ¤í„´ìŠ¤)â”‚  â”‚ (ë…ë¦½ ì¸ìŠ¤í„´ìŠ¤)â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ ì „ì—­ ìƒíƒœ A  â”‚  â”‚ ì „ì—­ ìƒíƒœ B  â”‚  â”‚ ì „ì—­ ìƒíƒœ C  â”‚
â”‚ ë²„í¼ A       â”‚  â”‚ ë²„í¼ B       â”‚  â”‚ ë²„í¼ C       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                â†“                 â†“
    ë²ˆì—­ ê²°ê³¼ A      ë²ˆì—­ ê²°ê³¼ B      ë²ˆì—­ ê²°ê³¼ C
    (ì •ìƒ)          (ì •ìƒ)           (ì •ìƒ)
```

ê° í”„ë¡œì„¸ìŠ¤ëŠ”:
- **ì™„ì „íˆ ë…ë¦½ëœ ë©”ëª¨ë¦¬ ê³µê°„**
- **ë…ë¦½ëœ DLL ì¸ìŠ¤í„´ìŠ¤**
- **ë…ë¦½ëœ ì „ì—­ ìƒíƒœ ë° ë²„í¼**

---

## í•µì‹¬ ë¬¸ì œì  ë° í•´ê²°ì±…

### 1. Rust í…ŒìŠ¤íŠ¸ ë°”ì´ë„ˆë¦¬ì˜ íŠ¹ì„±

Rustì˜ `cargo test`ë¡œ ìƒì„±ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ìì‹ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ë©´, **ì „ì²´ í…ŒìŠ¤íŠ¸ í•˜ë„¤ìŠ¤ê°€ ì‹¤í–‰**ë©ë‹ˆë‹¤.

```
# ë¶€ëª¨ì—ì„œ ìì‹ ìŠ¤í° ì‹œ ë°œìƒí•˜ëŠ” ë¬¸ì œ
ìì‹ í”„ë¡œì„¸ìŠ¤ stdout:
  "running 3 tests"
  "test test_foo ... ok"
  ...
```

**í•´ê²°ì±…**: í™˜ê²½ë³€ìˆ˜ë¡œ ì›Œì»¤ ëª¨ë“œë¥¼ ì²´í¬í•˜ê³ , íŠ¹ì • í…ŒìŠ¤íŠ¸ë§Œ `--exact` í”Œë˜ê·¸ë¡œ ì‹¤í–‰

```rust
// ì›Œì»¤ ì „ìš© í…ŒìŠ¤íŠ¸
#[test]
fn worker_runner() {
    if let Ok(params) = env::var("WORKER_PARAMS") {
        run_worker(&params);
        std::process::exit(0);  // ì¦‰ì‹œ ì¢…ë£Œ
    }
}

// ì½”ë””ë„¤ì´í„°ì—ì„œ ìŠ¤í° ì‹œ
Command::new(&current_exe)
    .env("WORKER_PARAMS", "...")
    .arg("worker_runner")  // í…ŒìŠ¤íŠ¸ ì´ë¦„
    .arg("--exact")        // ì •í™•íˆ ì´ í…ŒìŠ¤íŠ¸ë§Œ
    .arg("--nocapture")    // stdout ìº¡ì²˜ ì•ˆ í•¨
    .spawn()
```

### 2. stdout ë²„í¼ ë¸”ë¡œí‚¹

ì—¬ëŸ¬ ì›Œì»¤ì˜ stdoutì„ **ìˆœì°¨ì ìœ¼ë¡œ blocking read**í•˜ë©´, ì²« ë²ˆì§¸ ì›Œì»¤ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ ì›Œì»¤ë“¤ì˜ ë²„í¼ê°€ ê°€ë“ ì°¨ì„œ ë°ë“œë½ ë°œìƒ.

**í•´ê²°ì±…**: ìŠ¤ë ˆë“œì™€ ì±„ë„ì„ ì‚¬ìš©í•œ ë³‘ë ¬ ì½ê¸°

```rust
use std::sync::mpsc;
use std::thread;

let (tx, rx) = mpsc::channel();

for worker in workers {
    let tx_clone = tx.clone();
    thread::spawn(move || {
        let reader = BufReader::new(worker.stdout);
        for line in reader.lines() {
            tx_clone.send(line).ok();
        }
    });
}
drop(tx);  // ì›ë³¸ ì†¡ì‹ ì ë“œë¡­

// ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ëª¨ë“  ë©”ì‹œì§€ ìˆ˜ì‹ 
for msg in rx {
    // ì²˜ë¦¬
}
```

### 3. DLL ë™ì‹œ ë¡œë“œ ì¶©ëŒ

ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ê°™ì€ DLLì„ ë¡œë“œí•˜ë©´ ì¶©ëŒ ê°€ëŠ¥.

**í•´ê²°ì±…**: ì›Œì»¤ ìŠ¤í° ì‹œ ì•½ê°„ì˜ ì§€ì—°, ë˜ëŠ” ì›Œì»¤ ë‚´ì—ì„œ worker_id ê¸°ë°˜ ì§€ì—°

```rust
// ì½”ë””ë„¤ì´í„°ì—ì„œ
for (worker_id, ...) in work_assignments {
    spawn_worker(worker_id);
    thread::sleep(Duration::from_millis(100));  // ìŠ¤í° ê°„ ì§€ì—°
}

// ë˜ëŠ” ì›Œì»¤ì—ì„œ
fn run_worker(worker_id: usize) {
    thread::sleep(Duration::from_millis(worker_id as u64 * 500));
    let engine = EzTransEngine::new(&dll_path)?;
    // ...
}
```

### 4. ì½”ë””ë„¤ì´í„°ì—ì„œ DLL ë¡œë“œ í›„ í¬ë˜ì‹œ

ì½”ë””ë„¤ì´í„° í”„ë¡œì„¸ìŠ¤ì—ì„œ DLLì„ ë¡œë“œ/í…ŒìŠ¤íŠ¸í•œ í›„ ì›Œì»¤ë¥¼ ìŠ¤í°í•˜ë©´ ACCESS_VIOLATION ë°œìƒ.

**í•´ê²°ì±…**: ì½”ë””ë„¤ì´í„°ì—ì„œëŠ” DLLì„ ë¡œë“œí•˜ì§€ ì•ŠìŒ (ì›Œì»¤ë§Œ ë¡œë“œ)

```rust
fn coordinator() {
    // DLL í…ŒìŠ¤íŠ¸ ìƒëµ - ì›Œì»¤ë“¤ì´ ê°ì ë¡œë“œ
    println!("Skipping DLL test in coordinator");

    // ì›Œì»¤ ìŠ¤í°
    for ... {
        spawn_worker(...);
    }
}
```

---

## ê¶Œì¥ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Coordinator Process                       â”‚
â”‚  - DLL ë¡œë“œ ì•ˆ í•¨                                            â”‚
â”‚  - ì›Œì»¤ ìŠ¤í° (ìˆœì°¨ì , ì•½ê°„ì˜ ì§€ì—°)                            â”‚
â”‚  - mpsc ì±„ë„ë¡œ ëª¨ë“  ì›Œì»¤ ë©”ì‹œì§€ ìˆ˜ì‹                           â”‚
â”‚  - ì§„í–‰ë¥  ëŒ€ì‹œë³´ë“œ í‘œì‹œ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ spawn          â”‚ spawn          â”‚ spawn
         â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Worker 0   â”‚   â”‚  Worker 1   â”‚   â”‚  Worker 2   â”‚
â”‚  - DLL ë¡œë“œ  â”‚   â”‚  - DLL ë¡œë“œ  â”‚   â”‚  - DLL ë¡œë“œ  â”‚
â”‚  - ì‘ì—… ìˆ˜í–‰ â”‚   â”‚  - ì‘ì—… ìˆ˜í–‰ â”‚   â”‚  - ì‘ì—… ìˆ˜í–‰ â”‚
â”‚  - JSON ì¶œë ¥ â”‚   â”‚  - JSON ì¶œë ¥ â”‚   â”‚  - JSON ì¶œë ¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                â”‚                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ stdout (JSON)
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Reader Threads       â”‚
              â”‚  (ê° ì›Œì»¤ë‹¹ 1ê°œ)       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ mpsc channel
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Main Loop            â”‚
              â”‚  - ë©”ì‹œì§€ ì²˜ë¦¬         â”‚
              â”‚  - ì§„í–‰ë¥  ì—…ë°ì´íŠ¸     â”‚
              â”‚  - ê²°ê³¼ ìˆ˜ì§‘           â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì›Œì»¤-ì½”ë””ë„¤ì´í„° í”„ë¡œí† ì½œ

JSON ê¸°ë°˜ ë©”ì‹œì§€ í”„ë¡œí† ì½œ:

```rust
#[derive(Serialize, Deserialize)]
enum WorkerMessage {
    Progress {
        worker_id: usize,
        current_code: u32,
        tested: u32,
        found: u32,
    },
    ChunkResult {
        worker_id: usize,
        problematic_chars: Vec<u32>,
    },
    Complete {
        worker_id: usize,
        total_tested: u32,
        total_found: u32,
        elapsed_secs: f64,
    },
    Error {
        worker_id: usize,
        message: String,
    },
}
```

---

## ëŒ€ì•ˆ ì ‘ê·¼ë²• ë¹„êµ

### âŒ Thread-Local Storage (TLS)

```rust
thread_local! {
    static ENGINE: RefCell<Option<EzTransEngine>> = RefCell::new(None);
}
```

**ë¶ˆê°€ ì´ìœ **: LoadLibraryê°€ ë™ì¼ HMODULE ë°˜í™˜, DLL ì „ì—­ ìƒíƒœ ê³µìœ 

### âŒ Mutex ë³´í˜¸

```rust
let engine = Arc::new(Mutex::new(engine));
let guard = engine.lock().unwrap();
guard.translate_mmntw(text)?;
```

**ë¬¸ì œì **: ë³‘ë ¬ì„± ì—†ìŒ (ìˆœì°¨ ì‹¤í–‰ê³¼ ë™ì¼), ì¼ë¶€ ì¼€ì´ìŠ¤ì—ì„œ ì—¬ì „íˆ ì‹¤íŒ¨

### âŒ DLL ë³µì‚¬ í›„ ë‹¤ì¤‘ ë¡œë“œ

```rust
// J2KEngine_1.dll, J2KEngine_2.dll ë“±ìœ¼ë¡œ ë³µì‚¬
let engine1 = EzTransEngine::new("J2KEngine_1.dll")?;
let engine2 = EzTransEngine::new("J2KEngine_2.dll")?;
```

**ë¬¸ì œì **: ë¼ì´ì„ ìŠ¤/ë¦¬ì†ŒìŠ¤ ë¬¸ì œ ê°€ëŠ¥, ê´€ë¦¬ ë³µì¡ì„± ì¦ê°€

### âœ… ë©€í‹°í”„ë¡œì„¸ìŠ¤ (ê¶Œì¥)

```rust
// ê° í”„ë¡œì„¸ìŠ¤ê°€ ë…ë¦½ì ìœ¼ë¡œ DLL ë¡œë“œ
fn worker_process() {
    let engine = EzTransEngine::new(&dll_path)?;
    engine.initialize_ex("CSUSER123455", &dat_path)?;
    // ë²ˆì—­ ìˆ˜í–‰...
}
```

**ì¥ì **:
- ì™„ì „í•œ ê²©ë¦¬
- ì•ˆì •ì ì¸ ë³‘ë ¬ ì²˜ë¦¬
- í•œ ì›Œì»¤ í¬ë˜ì‹œê°€ ë‹¤ë¥¸ ì›Œì»¤ì— ì˜í–¥ ì—†ìŒ

---

## ì‹¤í–‰ ë°©ë²•

```bash
# V2 (ê°œì„ ëœ ë©€í‹°í”„ë¡œì„¸ìŠ¤) - ìë™ í”„ë¡œì„¸ìŠ¤ ìˆ˜
cargo test --target i686-pc-windows-msvc --test full_unicode_scan \
    scan_entire_unicode_range_parallel_v2 -- --ignored --nocapture

# V2 - 8 í”„ë¡œì„¸ìŠ¤ ê³ ì •
cargo test --target i686-pc-windows-msvc --test full_unicode_scan \
    scan_entire_unicode_range_parallel_v2_8_procs -- --ignored --nocapture

# ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸ (100ê°œ ë¬¸ì)
cargo test --target i686-pc-windows-msvc --test full_unicode_scan_mini \
    test_mini_multiprocess -- --nocapture

# ì¤‘ê°„ ê·œëª¨ í…ŒìŠ¤íŠ¸ (4000ê°œ ë¬¸ì)
cargo test --target i686-pc-windows-msvc --test full_unicode_scan_mini \
    test_medium_multiprocess -- --ignored --nocapture
```

---

## ì„±ëŠ¥ ì°¸ê³ 

| êµ¬ì„± | ì²˜ë¦¬ëŸ‰ | ë¹„ê³  |
|------|--------|------|
| ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤ | ~50-100 chars/sec | ê¸°ì¤€ì„  |
| 4 í”„ë¡œì„¸ìŠ¤ | ~200-400 chars/sec | 4ë°° í–¥ìƒ |
| 8 í”„ë¡œì„¸ìŠ¤ | ~400-800 chars/sec | 8ë°° í–¥ìƒ |

- ì „ì²´ ìœ ë‹ˆì½”ë“œ (1,112,064 codepoints): ì•½ 20-40ë¶„ ì˜ˆìƒ (8 í”„ë¡œì„¸ìŠ¤ ê¸°ì¤€)
- CPU ì½”ì–´ ìˆ˜ì— ë”°ë¼ ìµœì  í”„ë¡œì„¸ìŠ¤ ìˆ˜ ì¡°ì • ê¶Œì¥

---

## ê´€ë ¨ íŒŒì¼

- `tests/full_unicode_scan.rs` - ì „ì²´ ìŠ¤ìº” í…ŒìŠ¤íŠ¸ (V1, V2)
- `tests/full_unicode_scan_mini.rs` - ì†Œê·œëª¨/ì¤‘ê°„ ê·œëª¨ í…ŒìŠ¤íŠ¸
- `tests/multiprocess_test.rs` - ë©€í‹°í”„ë¡œì„¸ìŠ¤ ê¸°ë³¸ íŒ¨í„´ í…ŒìŠ¤íŠ¸
- `tests/thread_safety_test.rs` - ìŠ¤ë ˆë“œ ì•ˆì „ì„± í…ŒìŠ¤íŠ¸
- `tests/thread_local_test.rs` - Thread-Local ë°©ì‹ í…ŒìŠ¤íŠ¸ (ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ê¸°ë¡)

---

## í…ŒìŠ¤íŠ¸ ì¬í˜„ ë°©ë²•

Thread-Local ë¶ˆê°€ë¥¼ ì§ì ‘ í™•ì¸í•˜ë ¤ë©´:

```bash
# 1. ë‹¨ì¼ ìŠ¤ë ˆë“œ ë‹¤ì¤‘ ì—”ì§„ (ì„±ê³µ)
cargo test --target i686-pc-windows-msvc --test thread_local_test \
    test_single_thread_two_engines -- --ignored --nocapture

# 2. DLL í•¸ë“¤ ë™ì¼ì„± í™•ì¸ (ë™ì¼ HMODULE ë°˜í™˜ í™•ì¸)
cargo test --target i686-pc-windows-msvc --test thread_local_test \
    test_dll_handle_identity -- --ignored --nocapture

# 3. ë©€í‹°ìŠ¤ë ˆë“œ ë™ì‹œ ì ‘ê·¼ (í¬ë˜ì‹œ ë°œìƒ)
cargo test --target i686-pc-windows-msvc --test thread_local_test \
    test_thread_local_separate_engines -- --ignored --nocapture
```
